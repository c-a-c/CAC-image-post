# CAC-image-post（仮）

## 基本設計書
```
作成者: 朝倉滉人
作成日: 2025年2月2日　更新日: 2025年2月2日
```

- [技術スタック](#技術スタック)
- [システムの構成要素と名称](#システムの構成要素と名称)
    - [フロントエンド](#フロントエンド)
    - [バックエンド](#バックエンド)
- [機能別設計](#機能別設計)
    - [ログインページ](#ログインページ)
    - [TOPページ](#topページ)
    - [マイページ](#マイページ)
    - [投稿ページ](#投稿ページ)
    - [イベントページ](#イベントページ)
    - [いいね・コメント機能](#いいねコメント機能)
    - [セキュリティ](#セキュリティ)


### 技術スタック

- プログラミング言語
    - フロントエンド : TypeScript・React
    - バックエンド : Go
- データベース
    - Firebase Firestore（NoSQLデータベース）
- 認証
    - Firebase Authentication
- ストレージ
    - Firebase Storage
- ホスティング
    - Firebase Hosting

### システムの構成要素と名称

#### フロントエンド

| ファイル名 | 役割 | 使用技術 |
| :---: | :---: | :---: |
| login_page | ログインページの画面 | TS/React |
| top_page | TOPページの画面 | TS/React |
| my_page | マイページの画面 | TS/React |
| post_page | 投稿ページの画面 | TS/React |
| events_page | イベントページの画面 | TS/React |

#### バックエンド

| ファイル名 | 役割 | 使用技術 |
| :---: | :---: | :---: |
| auth | ユーザ登録・ログイン・ログアウト・部員チェック | Go |
| firebase | Firebase接続 | Go |
| manager | イラスト管理（イラスト投稿・イラスト取得・ユーザのイラスト取得・イラスト削除・イラスト編集） | Go |
| good | イラストに対していいねを追加 | Go |
| comment | イラストに対してコメントを追加・特定イラストのコメントを取得 | Go |
| session | ユーザのセッションを管理し、認証状態を維持 | Go |



### 機能別設計

#### ログインページ

- エンドポイント: /api/login
- 機能:
    - 大学用のメールアドレスとパスワードでログインします。
    - 部員のみがログインできるようにします。
- 実装例:
```Go
func login(w http.ResponseWriter, r *http.Request) {
    // リクエストからメールアドレスとパスワードを取得
    email := r.FormValue("email")
    password := r.FormValue("password")

    // Firebase Authenticationでログインを試行
    user, err := firebaseAuth.SignInWithEmailAndPassword(email, password)
    if err != nil {
        http.Error(w, "ログインに失敗しました", http.StatusUnauthorized)
        return
    }

    // 部員かどうかを確認
    if !isMember(user.Email) {
        http.Error(w, "部員のみがログインできます", http.StatusForbidden)
        return
    }

    // セッションを開始
    session, _ := store.Get(r, "session-name")
    session.Values["userID"] = user.UID
    session.Save(r, w)

    // ログイン成功
    w.Write([]byte("ログイン成功"))
}

func isMember(email string) bool {
    // 部員のメールアドレスリストをチェック
    members := []string{"member1@university.edu", "member2@university.edu"} // 例
    for _, member := range members {
        if email == member {
            return true
        }
    }
    return false
}
```

#### TOPページ

- エンドポイント: /api/illustrations
- 機能:
    - 全ユーザの投稿を取得し、時系列順、タグ順、ユーザ名順でソート可能にします。
- 実装例:
```Go
func getIllustrations(w http.ResponseWriter, r *http.Request) {
    // Firestoreからイラストを取得
    // クエリパラメータに基づいてソート
}
```

#### マイページ

- エンドポイント: /api/user/{userID}/illustrations
- 機能:
    - ユーザの投稿を取得、削除、編集します。
    - ログインが必要です。
- 実装例:
```Go
func getUserIllustrations(w http.ResponseWriter, r *http.Request) {
    // 認証チェック
    // Firestoreからユーザのイラストを取得
}

func deleteUserIllustration(w http.ResponseWriter, r *http.Request) {
    // 認証チェック
    // Firestoreからイラストを削除
}

func updateUserIllustration(w http.ResponseWriter, r *http.Request) {
    // 認証チェック
    // Firestoreでイラストを更新
}
```

#### 投稿ページ

- エンドポイント: /api/illustrations
- 機能:
    - イラストと関連情報を投稿します。
- 実装例:
```Go
func postIllustration(w http.ResponseWriter, r *http.Request) {
    // 認証チェック
    // Firebase Storageにイラストを保存
    // Firestoreにイラスト情報を保存
}
```

#### イベントページ


#### いいね・コメント機能

- エンドポイント: /api/illustrations/{illustrationID}/like
- 機能: 
    - イラストにいいねを追加します。
- 実装例:
```Go
func likeIllustration(w http.ResponseWriter, r *http.Request) {
    // 認証チェック
    // Firestoreでいいねを追加
}
```

- エンドポイント: /api/illustrations/{illustrationID}/comments
- 機能:
    - イラストにコメントを追加します。
- 実装例:
```Go
func addComment(w http.ResponseWriter, r *http.Request) {
    // 認証チェック
    // Firestoreにコメントを追加
}
```

#### セキュリティ
- 認証: 
    - Firebase Authenticationを使用して、大学用のメールアドレスとパスワードでログインします。
- データ保護: 
    - Googleスプレッドシートに保存するのではなく、Firebase Authenticationを使用することでセキュリティを強化する見込みです。
